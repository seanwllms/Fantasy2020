if (length(filelist) > 0) {
result <- map_chr(filelist, function(x) paste0(folder, x))
append(result, proj, after = 0)
} else {
result <- ""
}
return (result)
}
#build nested list with all of the data frames.
files <- map(projections, getfiles)
files
#make lists of file names
projections <- c("steamer", "depthcharts", "fans", "zips", "atc")
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
result <- map_chr(filelist, function(x) paste0(folder, x))
result <- append(result, proj, after = 0)
} else {
result <- ""
}
return (result)
}
#build nested list with all of the data frames.
files <- map(projections, getfiles)
files
#make lists of file names
projections <- c("steamer", "depthcharts", "fans", "zips", "atc")
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
result <- map_chr(filelist, function(x) paste0(folder, x))
names(result) <- proj
} else {
result <- ""
}
return (result)
}
#build nested list with all of the data frames.
files <- map(projections, getfiles)
files
projections <- c("steamer", "depthcharts", "fans", "zips", "atc")
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
result <- map_chr(filelist, function(x) paste0(folder, x))
} else {
result <- ""
}
return (result)
}
#build nested list with all of the data frames.
files <- map(projections, getfiles) %>%
keep(function(x) length(x) > 1) %>%
map(function(x) map(x, read_csv))
files[1]
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles) %>%
keep(function(x) length(x) > 1) %>%
map(function(x) map(x, read_csv))
hitterdata <- hitter_data_frames %>%
modify_depth(2, select, 1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid
)
hitterdata <- hitter_data_frames %>%
modify_depth(2, function(x) select(x, 1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid))
hitterdata <- hitter_data_frames %>%
modify_depth(1, function(x) select(x, 1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid))
hitterdata <- files %>%
modify_depth(1, select, 1)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
filelist
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
read_csv(x) %>%
mutate(proj=proj) %>%
select(1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
dfs
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames
projections <- c("steamer", "depthcharts", "fans", "zips", "atc")
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
read_csv(x) %>%
mutate(proj=proj) #%>%
#  select(1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
dfs
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames[[1]][[1]]
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, RBI) #%>%
#  select(1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
dfs
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, RBI) #%>%
#  select(1, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
dfs
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
dfs
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames[[1]]
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(dfs, nrow>0)
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(dfs, len(x) > 1)
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(dfs, length(x) > 1)
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(dfs, !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(dfs, !is.null)
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(function(x), !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(function(x) !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid)
})
keep(dfs, function(x) !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles)
hitter_data_frames
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles) %>%
keep(function(x) length(x) > 1)
hitter_data_frames
projections <- c("steamer", "depthcharts", "fans", "zips", "atc")
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, playerid) %>%
mutate(
HR_pa = HR/PA,
R_pa = R/PA,
RBI_pa = RBI/PA,
SB_pa = SB/PA,
playerid = as.character(playerid)
)
})
keep(dfs, function(x) !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles) %>%
keep(function(x) length(x) > 1)
hitter_data_frames
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, proj, playerid) %>%
mutate(
HR_pa = HR/PA,
R_pa = R/PA,
RBI_pa = RBI/PA,
SB_pa = SB/PA,
playerid = as.character(playerid)
)
})
keep(dfs, function(x) !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles) %>%
keep(function(x) length(x) > 1)
hitter_data_frames
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pluck(x, 1) %>%
pull(x, proj) %>%
unique()
})
hitter_data_frames[1]
pluck(hitter_data_frames, 1)
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(x, proj) %>%
unique()
})
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1)
})
proj_systems
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj)
})
proj_systems
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique()
})
proj_systems
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique() %>%
as.character
})
proj_systems
class(proj_systems)
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique() %>%
flatten()
})
proj_systems
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique() %>%
flatten()
}) %>%
list_merge()
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique() %>%
flatten()
})
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique()
})
proj_systems <- map(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique()
}) %>%
list_merge()
proj_systems
proj_systems <- map_chr(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique()
})
proj_systems
library(tidyverse)
###Load the coefficients data frame
load("coefs.rda")
###############################################################
################HITTER STUFF LIVES HERE#########################
################################################################
#Import and clean data on replacement levels
#read in league wide csv
replacement_hitters <- read.csv("replacement_hitters.csv", stringsAsFactors = FALSE)
replacement_hitters$Position <- c("catcher",
"first_base",
"second_base",
"shortstop",
"third_base",
"middle_infield",
"corner_infield",
"outfield",
"dh"
)
names(replacement_hitters)[2:6] <- sapply(names(replacement_hitters[c(2:6)]), paste, ".repl", sep="")
#rename columns
names(replacement_hitters) <- c("position",
"runs",
"hr",
"rbi",
"sb",
"avg")
#make lists of file names
projections <- c("steamer", "depthcharts", "fans", "zips", "atc")
getfiles <- function(proj) {
#build list of paths to files
folder <- paste0("./", proj, "/")
filelist <- list.files(folder)
if (length(filelist) > 0) {
filelist <- map_chr(filelist, function(x) paste0(folder, x))
}
#for each path, read csv file and clean it up
dfs <- map(filelist, function(x) {
if (!str_detect(x, "pitchers"))
read_csv(x) %>%
mutate(proj=proj) %>%
select(Name, Team, AB, PA, R,HR, RBI, SB, AVG, OBP, proj, playerid) %>%
mutate(
HR_pa = HR/PA,
R_pa = R/PA,
RBI_pa = RBI/PA,
SB_pa = SB/PA,
playerid = as.character(playerid)
)
})
keep(dfs, function(x) !is.null(x))
}
#build nested list with all of the data frames.
hitter_data_frames <- map(projections, getfiles) %>%
keep(function(x) length(x) > 1)
#build list of all projection systems successfully read
proj_systems <- map_chr(hitter_data_frames, function(x){
pluck(x, 1) %>%
pull(proj) %>%
unique()
})
#assign names in df list
names(hitter_data_frames) <- projections
len(hitter_data_frames)
#assign names in df list
names(hitter_data_frames) <- proj_systems
hitter_data_frames
